{%- macro rating(ProductRating) -%}
    <div class="control" style="padding-bottom:2em;">
        {% for i in range(0,5) %}
            {% if i < ProductRating %}
                <b style="color:gold;">
                {% else %}
                    <b style="color:black;">
                    {% endif %}
                    <span class="fa fa-star star"></span>
                    <br/>
                </b>
            {% endfor %}
{%- endmacro -%}
{%- macro modal(product) -%}
    <script>
        // Script for closing the product information modal
        document.addEventListener('DOMContentLoaded', () => {
            function closeAllModals() {
                (document.querySelectorAll('.modal') || []).forEach(($modal) => {
                closeModal($modal);
                });
            }

            (document.querySelectorAll('.modal-background, .modal-close, .modal-card-head .delete, .modal-card-foot .button') || []).forEach(($close) => {
                const $target = $close.closest('.modal');

                $close.addEventListener('click', () => {
                    closeModal($target);
                });
            });
        });
    </script>
    <div class="modal" id="{{ product.name }}_modal">
        <div class="modal-background"></div>
        <div class="modal-card"style="border-radius: 1em;">
            <header class="modal-card-head">
                <p class="modal-card-title">Product information</p>
                <button class="delete is-large" aria-label="close"></button>
            </header>
            <section class="modal-card-body">
                <article class="media">
                    <figure class="media-left">
                        <img class="center"
                             src="{{ product.image }}"
                             alt="Image for : {{ product.name }}"
                             style="max-height:50em;
                                    max-width:12em;
                                    height:auto;
                                    width:auto">
                    </figure>
                    <div class="media-content">
                        <div class="content">
                            <div class="column">
                                <div class="content">
                                    <div class="level is-mobile">
                                        <!-- These should be fetched from the db -->
                                        <span class="tag is-link">Bottle: Some_bottle</span>
                                        <span class="tag is-success">Grape: Some_grape</span>
                                        <span class="tag is-primary">Colour: Some_colour</span>
                                    </div>
                                    <article class="message is-dark is-large">
                                        <div class="message-header">
                                            <p class="price">{{ product.name }}</p>
                                        </div>
                                        <div class="message-body">{{ product.description }}</div>
                                    </article>
                                </div>
                            </div>
                        </div>
                    </div>
                </article>
            </section>
            <footer class="modal-card-foot has-text-centered"
                    style="justify-content:space-between">
                <div>In stock : {{ product.stock }}</div>    
                <div>Price : {{ product.price }} Kr/bottle</div>
                {% if product.stock > 0 %}
                <div class="field has-addons">
                    <div class="controll">
                        <input type="number" min="1" class="input is-numerical">
                    </div>
                    <div class="controll">
                        <button class="button is-success is-pulled-right">Add to cart</button>
                    </div>
                </div>
                {% else %}
                <fieldset disabled>
                    <div class="field has-addons">
                        <div class="controll">
                            <input type="number" min="0" class="input is-numerical">
                        </div>
                        <div class="controll">
                            <button class="button is-success is-pulled-right">Out of stock</button>
                        </div>
                    </div>
                </fieldset>
                {% endif %}
            </footer>
        </div>
    </div>
{%- endmacro -%}
{% macro listing(product) -%}
    {{ modal(product)}}
    <article class="media">
        <figure class="media-left">
            <a onclick="toggle_modal('{{ product.name }}_modal')" style="color:black;">
                <img class="center"
                     src="{{ product.image }}"
                     alt="Image for : {{ product.name }}"
                     width="100em">
            </a>
        </figure>
        <div class="media-content">
            <a href="/product/info/{{ product.serial_number }}" style="color:black;">
                <div class="content">
                    <h3>
                        <b>{{ product.name }}</b>
                    </h3>
                    <p class="price">Price = {{ product.price }}</p>
                </div>
            </a>
        </div>
    </article>
{%- endmacro %}
{% macro list_container(products) -%}
    {% set ns = namespace(counter=0) %}
    <div class="tile has-background-grey-lighter is-ancestor is-centered center">
        <div class="tile is-vertical is-fullwidth">
            {% for product in products %}
                {% if ns.counter % 4 == 0 %}
                    <div class="tile center">
                        <div class="tile  is-parent">
                        {% endif %}
                        <div class="tile is-child  is-vcentered">
                            {{ listing(product) }}
                            {% set ns.counter = ns.counter + 1 %}
                        </div>
                        {% if ns.counter % 4 == 0 %}
                        </div>
                    </div>
                    <hr class="has-background-grey-lighter"
                        style="outline:0;
                               border-top:1px solid gray">
                {% endif %}
            {% endfor %}
        </div>
    </div>
{%- endmacro %}
